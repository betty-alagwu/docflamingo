[
  {
    "sha": "a7a8214d923b5c031dcf0461341fd5406a31f205",
    "filename": "pages/api/dispatch.ts",
    "status": "modified",
    "additions": 5,
    "deletions": 5,
    "changes": 10,
    "blob_url": "https://github.com/betty-alagwu/heyme/blob/d20db164ce7af7bcf40afcdf57df4ba1f619e542/pages%2Fapi%2Fdispatch.ts",
    "raw_url": "https://github.com/betty-alagwu/heyme/raw/d20db164ce7af7bcf40afcdf57df4ba1f619e542/pages%2Fapi%2Fdispatch.ts",
    "contents_url": "https://api.github.com/repos/betty-alagwu/heyme/contents/pages%2Fapi%2Fdispatch.ts?ref=d20db164ce7af7bcf40afcdf57df4ba1f619e542",
    "patch": "@@ -25,13 +28,7 @@\n     .select(\"*\")\n     .where({ send_at: dayjs().format('YYYY-MM-DD') })\n }\n \n export async function updateVideoToSent(connection: Knex, id: number) {\n   await connection(\"Videos\").where({ id }).update({\n-    sent: 1,\n+    sent: ,\n   })\n }\n \n  async function handleDispatchEmails(\n   request: NextApiRequest,\n   response: NextApiResponse\n@@ -47,16 +50,10 @@\n   }\n \n   const url = \"api.zeptomail.com/\"\n   const token = process.env.ZEPTOMAIL_TOKEN\n   const client = new SendMailClient({ url, token })\n \n-  for (let index = 0; index < videos.length; index++) {\n-    const video = videos[index]\n+  for (let index = ; index < videos.length; index++) {\n+    const video = videos[]\n \n-    if (video.sent === 1) {\n+    if (video.sent === ) {\n       continue\n     }\n \n     const isYourself = video.send_to === \"yourself\"\n \n     video.created_at = dayjs(video.created_at).format(\"MMM D, YYYY\")\n@@ -87,13 +90,7 @@\n       }),\n     })\n \n     await updateVideoToSent(knex, video.id)\n   }\n \n-  await knex.destroy()\n+  await knex.\n   return response.json([])\n }\n export default withHighlight(handleDispatchEmails)\n\\ No newline at end of file",
    "newContent": {
      "name": "dispatch.ts",
      "path": "pages/api/dispatch.ts",
      "sha": "8b468b705a05a92dec17ce65ed4b065501381f66",
      "size": 2946,
      "url": "https://api.github.com/repos/betty-alagwu/heyme/contents/pages/api/dispatch.ts?ref=ac93d3c0821026d967e55e0eded4abb5bb5c968e",
      "html_url": "https://github.com/betty-alagwu/heyme/blob/ac93d3c0821026d967e55e0eded4abb5bb5c968e/pages/api/dispatch.ts",
      "git_url": "https://api.github.com/repos/betty-alagwu/heyme/git/blobs/8b468b705a05a92dec17ce65ed4b065501381f66",
      "download_url": "https://raw.githubusercontent.com/betty-alagwu/heyme/ac93d3c0821026d967e55e0eded4abb5bb5c968e/pages/api/dispatch.ts",
      "type": "file",
      "content": "aW1wb3J0IEZzIGZyb20gImZzIgppbXBvcnQgUGF0aCBmcm9tICJwYXRoIgpp\nbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJv\nbSAibmV4dCIKaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNt\nYS9jbGllbnQnCmltcG9ydCBkYXlqcyBmcm9tICJkYXlqcyIKaW1wb3J0IHsg\nU2VuZE1haWxDbGllbnQgfSBmcm9tICJ6ZXB0b21haWwiCmltcG9ydCB7IHdp\ndGhIaWdobGlnaHQgfSBmcm9tICcuLi8uLi9oaWdobGlnaHQuY29uZmlnJwoK\nZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEVtYWlsQ29udGVudCh7IHdhdGNo\nTGluaywgZ3JlZXRpbmcsIGJvZHksIG91dHJvIH0pIHsKICBsZXQgZW1haWxD\nb250ZW50ID0gRnMucmVhZEZpbGVTeW5jKAogICAgUGF0aC5yZXNvbHZlKCJw\ndWJsaWMiLCAibWFpbHMiLCAiZW1haWwuaHRtbCIpCiAgKS50b1N0cmluZygp\nCgogIGVtYWlsQ29udGVudCA9IGVtYWlsQ29udGVudC5yZXBsYWNlKCJ7e1JF\nUExBQ0VfV0FUQ0hfTElOS19IRVJFfX0iLCB3YXRjaExpbmspCiAgZW1haWxD\nb250ZW50ID0gZW1haWxDb250ZW50LnJlcGxhY2UoInt7UkVQTEFDRV9HUkVF\nVElOR19IRVJFfX0iLCBncmVldGluZykKICBlbWFpbENvbnRlbnQgPSBlbWFp\nbENvbnRlbnQucmVwbGFjZSgie3tSRVBMQUNFX0JPRFlfSEVSRX19IiwgYm9k\neSkKICBlbWFpbENvbnRlbnQgPSBlbWFpbENvbnRlbnQucmVwbGFjZSgie3tS\nRVBMQUNFX09VVFJPX0hFUkV9fSIsIG91dHJvKQoKICByZXR1cm4gZW1haWxD\nb250ZW50Cn0KCmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaEFsbFZpZGVv\nc0ZvclRvZGF5KHByaXNtYTogUHJpc21hQ2xpZW50KTogUHJvbWlzZTxhbnlb\nXT4gewogIHJldHVybiBwcmlzbWEudmlkZW9zLmZpbmRNYW55KHsKICAgIHdo\nZXJlOiB7CiAgICAgIHNlbmRfYXQ6IGRheWpzKCkuZm9ybWF0KCdZWVlZLU1N\nLUREJykKICAgIH0KICB9KQp9CgpleHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBk\nYXRlVmlkZW9Ub1NlbnQocHJpc21hOiBQcmlzbWFDbGllbnQsIGlkOiBudW1i\nZXIpIHsKICBhd2FpdCBwcmlzbWEudmlkZW9zLnVwZGF0ZSh7CiAgICB3aGVy\nZTogeyBpZCB9LAogICAgZGF0YTogewogICAgICBzZW50OiAxLAogICAgfQog\nIH0pCn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZURpc3BhdGNoRW1haWxzKAog\nIHJlcXVlc3Q6IE5leHRBcGlSZXF1ZXN0LAogIHJlc3BvbnNlOiBOZXh0QXBp\nUmVzcG9uc2UKKSB7CiAgLy8gY29ubmVjdCB0byBkYXRhYmFzZQogIGNvbnN0\nIHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKQoKICAvLyBmZXRjaCBhbGwg\ndmlkZW9zIGZyb20gZGF0YWJhc2Ugd2hlcmUgZGF0ZSBpcyB0b2RheS4KICBj\nb25zdCB2aWRlb3MgPSBhd2FpdCBmZXRjaEFsbFZpZGVvc0ZvclRvZGF5KHBy\naXNtYSkKCiAgaWYgKHZpZGVvcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVy\nbiByZXNwb25zZS5qc29uKFtdKQogIH0KCiAgY29uc3QgdXJsID0gImFwaS56\nZXB0b21haWwuY29tLyIKICBjb25zdCB0b2tlbiA9IHByb2Nlc3MuZW52LlpF\nUFRPTUFJTF9UT0tFTgogIGNvbnN0IGNsaWVudCA9IG5ldyBTZW5kTWFpbENs\naWVudCh7IHVybCwgdG9rZW4gfSkKCiAgZm9yIChsZXQgaW5kZXggPSAwOyBp\nbmRleCA8IHZpZGVvcy5sZW5ndGg7IGluZGV4KyspIHsKICAgIGNvbnN0IHZp\nZGVvID0gdmlkZW9zW2luZGV4XQoKICAgIGlmICh2aWRlby5zZW50ID09PSAx\nKSB7CiAgICAgIGNvbnRpbnVlCiAgICB9CgogICAgY29uc3QgaXNZb3Vyc2Vs\nZiA9IHZpZGVvLnNlbmRfdG8gPT09ICJ5b3Vyc2VsZiIKCiAgICB2aWRlby5j\ncmVhdGVkX2F0ID0gZGF5anModmlkZW8uY3JlYXRlZF9hdCkuZm9ybWF0KCJN\nTU0gRCwgWVlZWSIpCgogICAgYXdhaXQgY2xpZW50LnNlbmRNYWlsKHsKICAg\nICAgYm91bmNlX2FkZHJlc3M6ICJib3VuY2VAbWFpbHMuaGV5bWUuaW8iLAog\nICAgICBmcm9tOiB7CiAgICAgICAgYWRkcmVzczogImJldHR5QGhleW1lLmlv\nIiwKICAgICAgICBuYW1lOiAiQmV0dHkgZnJvbSBIZXltZSIsCiAgICAgIH0s\nCiAgICAgIHRvOiBbCiAgICAgICAgewogICAgICAgICAgZW1haWxfYWRkcmVz\nczogewogICAgICAgICAgICBhZGRyZXNzOiB2aWRlby5lbWFpbCwKICAgICAg\nICAgIH0sCiAgICAgICAgfSwKICAgICAgXSwKICAgICAgc3ViamVjdDogaXNZ\nb3Vyc2VsZgogICAgICAgID8gYFlvdSBzZW50IHlvdXJzZWxmIGEgbWVzc2Fn\nZSBmcm9tIHRoZSBwYXN0LiBDaGVjayBpdCBvdXQuYAogICAgICAgIDogYFNv\nbWVvbmUgc2VudCB5b3UgYSBtZXNzYWdlIGZyb20gdGhlIHBhc3QuIENoZWNr\nIGl0IG91dC5gLAogICAgICBodG1sYm9keTogZ2V0RW1haWxDb250ZW50KHsK\nICAgICAgICB3YXRjaExpbms6IGAke3Byb2Nlc3MuZW52LlNJVEVfVVJMfS93\nYXRjaC8ke3ZpZGVvLmlkfWAsCiAgICAgICAgZ3JlZXRpbmc6IGlzWW91cnNl\nbGYKICAgICAgICAgID8gYERvIHlvdSBzdGlsbCByZW1lbWJlciBzZW5kaW5n\nIHlvdXJzZWxmIGEgbWVzc2FnZSBvbiAke3ZpZGVvLmNyZWF0ZWRfYXR9P2AK\nICAgICAgICAgIDogYFNvbWVvbmUgc2VudCB5b3UgYSBtZXNzYWdlIG9uICR7\ndmlkZW8uY3JlYXRlZF9hdH1gLAogICAgICAgIGJvZHk6IGBUaGlzIG1lc3Nh\nZ2Ugd2FzIHNlbnQgdXNpbmcgb3VyIGZ1dHVyZSBtZXNzYWdlIHNlcnZpY2Ug\nY2FsbGVkIDxhIGhyZWY9Imh0dHBzOi8vaGV5bWUuaW8iIHRhcmdldD0iX2Js\nYW5rIj5oZXltZTwvYT4uYCwKICAgICAgICBvdXRybzogIlRoYW5rIHlvdSBm\nb3IgdXNpbmcgb3VyIHNlcnZpY2UuIiwKICAgICAgfSksCiAgICB9KQoKICAg\nIGF3YWl0IHVwZGF0ZVZpZGVvVG9TZW50KHByaXNtYSwgdmlkZW8uaWQpCiAg\nfQoKICBhd2FpdCBwcmlzbWEuJGRpc2Nvbm5lY3QoKQogIHJldHVybiByZXNw\nb25zZS5qc29uKFtdKQp9CmV4cG9ydCBkZWZhdWx0IHdpdGhIaWdobGlnaHQo\naGFuZGxlRGlzcGF0Y2hFbWFpbHMp\n",
      "encoding": "base64",
      "_links": {
        "self": "https://api.github.com/repos/betty-alagwu/heyme/contents/pages/api/dispatch.ts?ref=ac93d3c0821026d967e55e0eded4abb5bb5c968e",
        "git": "https://api.github.com/repos/betty-alagwu/heyme/git/blobs/8b468b705a05a92dec17ce65ed4b065501381f66",
        "html": "https://github.com/betty-alagwu/heyme/blob/ac93d3c0821026d967e55e0eded4abb5bb5c968e/pages/api/dispatch.ts"
      }
    },
    "originalContent": {
      "name": "dispatch.ts",
      "path": "pages/api/dispatch.ts",
      "sha": "3758734f63f50ca890f6419d0c146d39a5342050",
      "size": 2955,
      "url": "https://api.github.com/repos/betty-alagwu/heyme/contents/pages/api/dispatch.ts?ref=a055bee4ad07f9f558689fd2bf9972d2febb3bf5",
      "html_url": "https://github.com/betty-alagwu/heyme/blob/a055bee4ad07f9f558689fd2bf9972d2febb3bf5/pages/api/dispatch.ts",
      "git_url": "https://api.github.com/repos/betty-alagwu/heyme/git/blobs/3758734f63f50ca890f6419d0c146d39a5342050",
      "download_url": "https://raw.githubusercontent.com/betty-alagwu/heyme/a055bee4ad07f9f558689fd2bf9972d2febb3bf5/pages/api/dispatch.ts",
      "type": "file",
      "content": "aW1wb3J0IEZzIGZyb20gImZzIgppbXBvcnQgUGF0aCBmcm9tICJwYXRoIgpp\nbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJv\nbSAibmV4dCIKaW1wb3J0IHsgY3JlYXRlTXlzcWxDb25uZWN0aW9uIH0gZnJv\nbSAiQC91dGlscy9zZXJ2ZXIiCmltcG9ydCBkYXlqcyBmcm9tICJkYXlqcyIK\naW1wb3J0IHR5cGUgeyBLbmV4IH0gZnJvbSAia25leCIKaW1wb3J0IHsgU2Vu\nZE1haWxDbGllbnQgfSBmcm9tICJ6ZXB0b21haWwiCmltcG9ydCB7IHdpdGhI\naWdobGlnaHQgfSBmcm9tICcuLi8uLi9oaWdobGlnaHQuY29uZmlnJwoKZXhw\nb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEVtYWlsQ29udGVudCh7IHdhdGNoTGlu\naywgZ3JlZXRpbmcsIGJvZHksIG91dHJvIH0pIHsKICBsZXQgZW1haWxDb250\nZW50ID0gRnMucmVhZEZpbGVTeW5jKAogICAgUGF0aC5yZXNvbHZlKCJwdWJs\naWMiLCAibWFpbHMiLCAiZW1haWwuaHRtbCIpCiAgKS50b1N0cmluZygpCgog\nIGVtYWlsQ29udGVudCA9IGVtYWlsQ29udGVudC5yZXBsYWNlKCJ7e1JFUExB\nQ0VfV0FUQ0hfTElOS19IRVJFfX0iLCB3YXRjaExpbmspCiAgZW1haWxDb250\nZW50ID0gZW1haWxDb250ZW50LnJlcGxhY2UoInt7UkVQTEFDRV9HUkVFVElO\nR19IRVJFfX0iLCBncmVldGluZykKICBlbWFpbENvbnRlbnQgPSBlbWFpbENv\nbnRlbnQucmVwbGFjZSgie3tSRVBMQUNFX0JPRFlfSEVSRX19IiwgYm9keSkK\nICBlbWFpbENvbnRlbnQgPSBlbWFpbENvbnRlbnQucmVwbGFjZSgie3tSRVBM\nQUNFX09VVFJPX0hFUkV9fSIsIG91dHJvKQoKICByZXR1cm4gZW1haWxDb250\nZW50Cn0KCmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaEFsbFZpZGVvc0Zv\nclRvZGF5KGNvbm5lY3Rpb246IEtuZXgpOiBQcm9taXNlPGFueVtdPiB7CiAg\ncmV0dXJuIGNvbm5lY3Rpb24oIlZpZGVvcyIpCiAgICAuc2VsZWN0KCIqIikK\nICAgIC53aGVyZSh7IHNlbmRfYXQ6IGRheWpzKCkuZm9ybWF0KCdZWVlZLU1N\nLUREJykgfSkKfQoKZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVZpZGVv\nVG9TZW50KGNvbm5lY3Rpb246IEtuZXgsIGlkOiBudW1iZXIpIHsKICBhd2Fp\ndCBjb25uZWN0aW9uKCJWaWRlb3MiKS53aGVyZSh7IGlkIH0pLnVwZGF0ZSh7\nCiAgICBzZW50OiAxLAogIH0pCn0KCiBhc3luYyBmdW5jdGlvbiBoYW5kbGVE\naXNwYXRjaEVtYWlscygKICByZXF1ZXN0OiBOZXh0QXBpUmVxdWVzdCwKICBy\nZXNwb25zZTogTmV4dEFwaVJlc3BvbnNlCikgewogIC8vIGNvbm5lY3QgdG8g\nZGF0YWJhc2UKICBjb25zdCBrbmV4ID0gY3JlYXRlTXlzcWxDb25uZWN0aW9u\nKCkKCiAgLy8gZmV0Y2ggYWxsIHZpZGVvcyBmcm9tIGRhdGFiYXNlIHdoZXJl\nIGRhdGUgaXMgdG9kYXkuCiAgY29uc3QgdmlkZW9zID0gYXdhaXQgZmV0Y2hB\nbGxWaWRlb3NGb3JUb2RheShrbmV4KQoKICBpZiAodmlkZW9zLmxlbmd0aCA9\nPT0gMCkgewogICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oW10pCiAgfQoKICBj\nb25zdCB1cmwgPSAiYXBpLnplcHRvbWFpbC5jb20vIgogIGNvbnN0IHRva2Vu\nID0gcHJvY2Vzcy5lbnYuWkVQVE9NQUlMX1RPS0VOCiAgY29uc3QgY2xpZW50\nID0gbmV3IFNlbmRNYWlsQ2xpZW50KHsgdXJsLCB0b2tlbiB9KQoKICBmb3Ig\nKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdmlkZW9zLmxlbmd0aDsgaW5kZXgr\nKykgewogICAgY29uc3QgdmlkZW8gPSB2aWRlb3NbaW5kZXhdCgogICAgaWYg\nKHZpZGVvLnNlbnQgPT09IDEpIHsKICAgICAgY29udGludWUKICAgIH0KCiAg\nICBjb25zdCBpc1lvdXJzZWxmID0gdmlkZW8uc2VuZF90byA9PT0gInlvdXJz\nZWxmIgoKICAgIHZpZGVvLmNyZWF0ZWRfYXQgPSBkYXlqcyh2aWRlby5jcmVh\ndGVkX2F0KS5mb3JtYXQoIk1NTSBELCBZWVlZIikKCiAgICBhd2FpdCBjbGll\nbnQuc2VuZE1haWwoewogICAgICBib3VuY2VfYWRkcmVzczogImJvdW5jZUBt\nYWlscy5oZXltZS5pbyIsCiAgICAgIGZyb206IHsKICAgICAgICBhZGRyZXNz\nOiAiYmV0dHlAaGV5bWUuaW8iLAogICAgICAgIG5hbWU6ICJCZXR0eSBmcm9t\nIEhleW1lIiwKICAgICAgfSwKICAgICAgdG86IFsKICAgICAgICB7CiAgICAg\nICAgICBlbWFpbF9hZGRyZXNzOiB7CiAgICAgICAgICAgIGFkZHJlc3M6IHZp\nZGVvLmVtYWlsLAogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICBdLAog\nICAgICBzdWJqZWN0OiBpc1lvdXJzZWxmCiAgICAgICAgPyBgWW91IHNlbnQg\neW91cnNlbGYgYSBtZXNzYWdlIGZyb20gdGhlIHBhc3QuIENoZWNrIGl0IG91\ndC5gCiAgICAgICAgOiBgU29tZW9uZSBzZW50IHlvdSBhIG1lc3NhZ2UgZnJv\nbSB0aGUgcGFzdC4gQ2hlY2sgaXQgb3V0LmAsCiAgICAgIGh0bWxib2R5OiBn\nZXRFbWFpbENvbnRlbnQoewogICAgICAgIHdhdGNoTGluazogYCR7cHJvY2Vz\ncy5lbnYuU0lURV9VUkx9L3dhdGNoLyR7dmlkZW8uaWR9YCwKICAgICAgICBn\ncmVldGluZzogaXNZb3Vyc2VsZgogICAgICAgICAgPyBgRG8geW91IHN0aWxs\nIHJlbWVtYmVyIHNlbmRpbmcgeW91cnNlbGYgYSBtZXNzYWdlIG9uICR7dmlk\nZW8uY3JlYXRlZF9hdH0/YAogICAgICAgICAgOiBgU29tZW9uZSBzZW50IHlv\ndSBhIG1lc3NhZ2Ugb24gJHt2aWRlby5jcmVhdGVkX2F0fWAsCiAgICAgICAg\nYm9keTogYFRoaXMgbWVzc2FnZSB3YXMgc2VudCB1c2luZyBvdXIgZnV0dXJl\nIG1lc3NhZ2Ugc2VydmljZSBjYWxsZWQgPGEgaHJlZj0iaHR0cHM6Ly9oZXlt\nZS5pbyIgdGFyZ2V0PSJfYmxhbmsiPmhleW1lPC9hPi5gLAogICAgICAgIG91\ndHJvOiAiVGhhbmsgeW91IGZvciB1c2luZyBvdXIgc2VydmljZS4iLAogICAg\nICB9KSwKICAgIH0pCgogICAgYXdhaXQgdXBkYXRlVmlkZW9Ub1NlbnQoa25l\neCwgdmlkZW8uaWQpCiAgfQoKICBhd2FpdCBrbmV4LmRlc3Ryb3koKQogIHJl\ndHVybiByZXNwb25zZS5qc29uKFtdKQp9CmV4cG9ydCBkZWZhdWx0IHdpdGhI\naWdobGlnaHQoaGFuZGxlRGlzcGF0Y2hFbWFpbHMp\n",
      "encoding": "base64",
      "_links": {
        "self": "https://api.github.com/repos/betty-alagwu/heyme/contents/pages/api/dispatch.ts?ref=a055bee4ad07f9f558689fd2bf9972d2febb3bf5",
        "git": "https://api.github.com/repos/betty-alagwu/heyme/git/blobs/3758734f63f50ca890f6419d0c146d39a5342050",
        "html": "https://github.com/betty-alagwu/heyme/blob/a055bee4ad07f9f558689fd2bf9972d2febb3bf5/pages/api/dispatch.ts"
      }
    },
    "num_plus_lines": 5,
    "num_minus_lines": 5
  }
]